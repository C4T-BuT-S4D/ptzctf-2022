# PTZCTF 2022 | Hard / Crypto | strange-diffie-hellman

## Описание

> Мы нашли два каких-то странных числа и реализовали с ними обычный Диффи-Хеллман.

## Раздатка

Участникам нужно выдать файлы:

* [public/crypto-strange-diffie-hellman.zip](public/crypto-strange-diffie-hellman.zip)

## Деплой

Не требуется.

## Решение

В таске реализована имитация атаки MITM: с помощью алгоритма Диффи-Хеллмана вычисляется общий ключ, затем этим ключом шифруется флаг. Сам алгоритм реализован корректно и без уязвимостей, поэтому нужно исследовать числа g (генератор) и p (модуль).

Попробуем факторизовать число `p - 1` (порядок группы). Наивная факторизация и factordb, скорее всего, ничего не найдут, но более сложные алгоритмы, такие как ECM (можно использвать утилиту ecmfactor или yafu), обнаружат маленький делитель: 1858542031.

Нам нужно узнать порядок числа g: так как полную факторизацию мы не знаем, попробуем возвести g в известные делители. Узнаём, что:

```
g ^ 1858542031 == 1 (mod p)
```

Это значит, что число g имеет маленький порядок — 32 бита. Теперь мы можем вычислить дискретный логарифм и найти alice_secret, для этого воспользуемся алгоритмом Шенкса (baby-step giant-step).

Когда мы нашли alice_secret, можем посчитать alice_shared и расшифровать флаг.

## Флаг

```
ptzctf{sm4ll_multiplicat1ve_ord3r}
```
