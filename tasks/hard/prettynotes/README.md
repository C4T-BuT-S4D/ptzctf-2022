# hard | web | pretty-notes

## Описание

Мой одноклассник создал свой сайтик, чтобы мы могли делиться заметками.

[http://{IP}:8008](http://{IP}:8008)

В админском аккаунте он оставил флаг. На уроке информатики я смог подсмотреть код его сайта.

## Информация

Лик секретного ключа Python-приложения с помощью инъекции в форматную строку.

## Решение

Нам даётся исходный код приложения. В функции `app.get_note` форматная строка создается из пользовательского ввода (
параметр ?styling).

Зная это, мы можем вытащить данные программы, используя факт что в вызов .format() будет подставлено 2 переменных: np(
NotePresenter), note(Note).
У класса NotePresenter определен метод paragraphs(), сам класс находится в той же области видимости, что и главный
объект веб-приложения.

Общий ход решения:

1. Регистрируемся
2. Создаем заметку
3. Отправляем запрос на просмотр заметки с
   параметром `note/<note_id>?styling={np.paragraphs.__globals__[app].secret_key}`.
4. В ответе получаем секретный ключ (`s3cret_ab45ef0783ac7581be3a5ffee7cfe270fa52a284`)
5. Используя полученный секретный ключ генерируем себе cookie `session` для пользователя `admin`. Для этого можно
   использовать утилиту [flask-session-cookie-manager](https://github.com/noraj/flask-session-cookie-manager).
6. Ставим себе cookie и заходим на страницу /notes, читаем флаг.

[Эксплоит](solve/solve.py)

## Флаг

`ptzctf{6e6b4ff9854b779d5da0c8ec75cc93de747f69cd}`